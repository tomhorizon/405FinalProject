<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405 Final Project: Overview - Learn by Dueling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="WarCrimesLogoSmall.png"/></td>
  <td id="projectalign">
   <div id="projectname">ME 405 Final Project<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Contains software to control a heat-seaking Nerf turret to capture, aim at, and shoot a target</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__c___users_phlip__one_drive____cal__poly__m_e_405__mechatronics_405_final_project_src__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview - Learn by Dueling </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Thomas Taylor</p>
<p>Dylan Weiglein</p>
<p>Jonathan Fraser</p>
<p>Cal Poly, San Luis Obispo</p>
<p>Winter Quarter 2023</p>
<p>ME-405 Term Project</p>
<p>Thank you to Professor John R. Ridgely for the project. It was a great experience.</p>
<div class="image">
<img src="imgInitialRender.png" alt=""/>
<div class="caption">
Figure 0: Early concept art of the turret (Fusion 360).</div></div>
    <p>This project was a showcase of all programming and hardware skills acquired over the last two quarters of our Mechatronics education. The goal of the project was to integrate motor control, sensors, communication protocols, and inspire creativity with an open-ended design.</p>
<p>The competition goal was to create a machine that uses a thermal camera to direct a nerf dart to an opponent in the shortest amount of time. The rules were simple - each time has five seconds to rotate their machine from rear facing to front facing, acquire a target, and ten seconds to fire. The first team to land a hit scored three points, the second team to hit scored one point, any misses subtracted a point, and any subsequent hits did not affect the score.</p>
<p>This exercise is an early study on the possibility of targetting embers falling through the sky and precisely extinguishing them before they have a chance to cause further wildfire damage. In theory, a network of these machines that use thermal data for targetting can prevent the spread of fires.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Hardware</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Mechanical</h2>
<p>The machine is actuated by two 200rpm 24v encoded motors to control rotation and pitch. With an internal gearing of 50:1 and an external gearing of 4:1, the machine is able to rotate about either axis at 1 revolution per second. Two 24v 12,000rpm motors with 5" diameter flywheels enthusiastically send darts down a lightweight 12" aluminum barrel. A maximum of 12 Nerf Accustrike darts are fed from a factory magazine, which are pushed into the path of the flywheels by a 25kg 180deg hobby servo linked by pin and slot mechanism to a custom machined 3/8" firing rod. A custom 3D printed receiver supports the magazine, firing rod, and rear of the barrel. 

The support structure is a combination of laser cut 12g steel and 3D printed pivot mechanisms. The base of the machine rotates on an 8" lazy Susan ball bearing unit. It is bolted to a bespoke wooden base with adequate clearance for the yaw gearing. This is further supported by a brake disc to prevent slipping and under-rotation of the turret.</p>
<div class="image">
<img src="imgFullTurret2.png" alt=""/>
<div class="caption">
Figure 1: Final system render.</div></div>
    <div class="image">
<img src="imgMotorsAndGearing.png" alt=""/>
<div class="caption">
Figure 2: Motors and gear system.</div></div>
    <div class="image">
<img src="imgForwardFiringGroup.png" alt=""/>
<div class="caption">
Figure 3: Front firing group assembly.</div></div>
    <div class="image">
<img src="imgRearFiringGroup.png" alt=""/>
<div class="caption">
Figure 4: Rear firing group assembly.</div></div>
    <h2><a class="anchor" id="autotoc_md3"></a>
Electronics</h2>
<p>All electronics are secured to a custom 3D printed electronics control box. They are powered by a 24V 15A power supply with an emergency stop and 15A fuse. This is stepped down to provide 7.9V to the hobby servo and 5V to the control logic, encoders, and LEDs.</p>
<p>The 24V motors are powered by two Dual L298 DC Motor drivers. A limit switch on a tether is used as a "start" button to signal the machine to start a new round. A Melexis MLX90640 thermal camera mounted to the barrel provides machine vision.</p>
<p>To add to the overall aesthetic of the design, a 3.3-24V alarm and three 5V pre-resisted red LEDs alert the opponent of their approaching fate.</p>
<p>Our microcontroller is an STM32 L476RG running MicroPython.</p>
<div class="image">
<img src="imgControlBox.png" alt=""/>
<div class="caption">
Figure 5: Control box rendering.</div></div>
    <div class="image">
<img src="imgWiringDiagram.png" alt=""/>
<div class="caption">
Figure 6: Wiring diagram.</div></div>
    <div class="image">
<img src="imgPinout.png" alt=""/>
<div class="caption">
Figure 7: Nucleo pinout.</div></div>
    <h1><a class="anchor" id="autotoc_md4"></a>
Software</h1>
<p>Our software utilizes I2C communication to retrieve images from the infrared camera. The captured images are then processed using a targeting algorithm to detect human targets. Once a target has been detected, a PID control algorithm is employed to control the encoder motors, which are used to fire a Nerf dart accurately towards our target.</p>
<p>In competition, the idling system waits for the "Go" signal from the user switch. Upon detection, it:</p><ul>
<li>Starts a master timer</li>
<li>Rotates 180 degrees to face the opponent</li>
<li>Once five seconds has passed (both teams freeze), capture a thermal image</li>
<li>Process the most likely location for a human's center of mass</li>
<li>Send a correction in yaw and pitch to the motors and allows for 0.25s of movement</li>
<li>Fires a single shot</li>
<li>Returns "home"</li>
</ul>
<p>The targeting algorithm was refined over many test sessions. Once data is captured, the algorith:</p><ul>
<li>Checks a specified range of columns and sums the heat values above a threshold level</li>
<li>Looks for the largest value in the largest summed row</li>
</ul>
<p>We were getting unreliable data from a weighted average system. Although we had mostly successful hit, occasionally the turret would aim a bit too high (face level) which was tougher to hit than chest level.</p>
<div class="image">
<img src="imgThermalImage.png" alt=""/>
<div class="caption">
Figure 8: Example thermal image.</div></div>
    <p>Detailed software information can be found in our <a href="https://github.com/tomhorizon/405FinalProject">repository</a>.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Results</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Testing</h2>
<p>Testing took a significant amount of time as we fine-tuned the machine. Some of the issues we ran in to were:</p>
<ul>
<li>The firing pin. We made small adjustments to ensure it had a consistent and reliable range of motion, which was achieved by using a servo and linkage mechanism.</li>
<li>The flywheels had issues with drawing too much current on startup. We had to ensure that they propelled the dart straight towards the target and did not draw too much current, which could affect the system's overall performance. We had one issue with the early press-fit flywheels (before flange mounting) where the system abruptly came to full power and a flywheel came off. One monitor and one keyboard were damaged beyond repair.</li>
<li>The pitch and yaw movement were tested to verify that the system was capable of accurately aiming the Nerf dart towards the target. We found issues in the gearing system where, over time, the gears could creep out of place. Reinforcements were made to the yaw large gear and an idler was added to the pitch belt.</li>
<li>The accuracy of the targeting algorithm was also tested to ensure that it correctly identified and tracked human targets, further enhancing the precision of the system. We ended up fine-tuning our algorithm with small offsets to pitch and yaw to ensure it more frequently hit our human targets.</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Performance</h2>
<p>The competition took place over two days. Unfortunately, the first day went poorly and we missed all five of our bouts with our first opponent. The turret mostly shot left by a few degrees, missing entirely. The frustration was compounded by the fact that the turret hit consistently in testing before, and after, the match.</p>
<p>On the second day of competition, the turret performed with striking accuracy with no change in code. It is possible that it was a cooler day and there was less thermal noise in the background.</p>
<div class="image">
<img src="scoreboard.png" alt=""/>
<div class="caption">
Figure 9: Final score bracket.</div></div>
    <h2><a class="anchor" id="autotoc_md8"></a>
Final Product Pictures</h2>
<div class="image">
<img src="imgRealFullTurret.jpg" alt=""/>
<div class="caption">
Figure 10: Final production unit.</div></div>
    <div class="image">
<img src="imgRealTurretFront.jpg" alt=""/>
<div class="caption">
Figure 11: Front view.</div></div>
    <div class="image">
<img src="imgRealTopDown.jpg" alt=""/>
<div class="caption">
Figure 12: Topdown view.</div></div>
    <div class="image">
<img src="imgRealControlBox.png" alt=""/>
<div class="caption">
Figure 13: The fully wired control box.</div></div>
    <h2><a class="anchor" id="autotoc_md9"></a>
Takeaways</h2>
<p>Overall, building our own system rather than relying on pre-existing Nerf hardware was a success, as it allowed us to create a more intricate and finished design. We also had ample time to put into the project, which allowed us to thoroughly test each subsystem and the system as a whole, which was critical in identifying issues and debugging them.</p>
<p>However, certain algorithms, such as the weighted average for targeting, did not work as well as we had hoped. Along with this, pure proportional control with a single fixed setpoint caused constant overshooting, which affected the accuracy of the system. Additionally, the vibrations from the flywheels caused issues with the overall stability of the system and led to certain other systems failing or becoming unreliable.</p>
<p>For anyone interested in continuing our research, we recommend using a higher resolution thermal camera and a faster processing unit. A major drawback of the system was the ability to distinguish a human at a range of sixteen feet. The quickest we were able to pull an image was 0.480s - a faster processor would allow for real-time tracking and firing before the five second "freeze" mark.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Links</h1>
<p><b>Videos (YouTube)</b></p>
<p><a href="https://youtu.be/L2fNEF87ndI">1: Compilation of championship day (3/17/2023)</a></p>
<p><a href="https://youtu.be/JrsSzEOzaZ4">2: Close-up view of operation</a></p>
<p><b>Purchases</b></p>
<p><em><b>Mechanical</b></em></p>
<p><a href="https://www.amazon.com/dp/B07T2C6VDH?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">Ball Bearing Base</a></p>
<p><a href="https://www.amazon.com/dp/B082PSMWXD?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">Pivot Bearings</a></p>
<p><a href="https://www.amazon.com/dp/B0BKLFHRTP?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">Pulley Sets</a></p>
<p><a href="https://www.amazon.com/gp/product/B08ZT3S38L/ref=ppx_yo_dt_b_asin_title_o03_s00?ie=UTF8&amp;psc=1">24v Encoded Motors</a></p>
<p><a href="https://www.amazon.com/gp/product/B08NTK8JXZ/ref=ppx_yo_dt_b_asin_title_o03_s03?ie=UTF8&amp;psc=1">12,000rpm 24v 775 Motors</a></p>
<p><a href="https://www.amazon.com/gp/product/B07GJ6ZCVY/ref=ppx_yo_dt_b_asin_title_o03_s03?ie=UTF8&amp;psc=1">Hobby Servo</a></p>
<p><a href="https://www.amazon.com/gp/product/B076JGQP8W/ref=ppx_yo_dt_b_asin_title_o03_s03?ie=UTF8&amp;psc=1">Nerf Darts</a></p>
<p><a href="https://www.mcmaster.com/8632T132/">D Shaft</a></p>
<p><a href="https://www.mcmaster.com/89895K762-89895K264/">Barrel</a></p>
<p><a href="https://www.amazon.com/dp/B07PFW6GKL?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">Flywheel Flanges</a></p>
<p><em><b>Electrical</b></em></p>
<p><a href="https://www.amazon.com/gp/product/B06XK2ZNKC/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&amp;psc=1">Power Supply</a></p>
<p><a href="https://www.amazon.com/dp/B09SB6JLS7?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">24v to 7.9v Converter</a></p>
<p><a href="https://www.amazon.com/gp/product/B01M03288J/ref=ppx_yo_dt_b_asin_title_o03_s01?ie=UTF8&amp;psc=1">24v to 5v Converter</a></p>
<p><a href="https://www.amazon.com/gp/product/B08FC1851N/ref=ppx_od_dt_b_asin_title_s02?ie=UTF8&amp;psc=1">DC Motor Driver</a></p>
<p><a href="https://www.amazon.com/gp/product/B093PWRJS9/ref=ppx_od_dt_b_asin_title_s03?ie=UTF8&amp;psc=1">Power Busses</a></p>
<p><a href="https://a.co/d/5AqA7yo">E-Stop</a></p>
<p><a href="https://www.amazon.com/dp/B07TNHH6ML?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">Pre-wired LEDs</a></p>
<p><a href="https://www.amazon.com/dp/B07QBP1W5L?psc=1&amp;ref=ppx_yo2ov_dt_b_product_details">Buzzer</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
